# План реализации веб-админки RemnaWave Bedolaga Bot

Документ фиксирует этапы разработки админ-панели и служит чек-листом прогресса. Этапы помечаются галочками по мере выполнения.

## Этап 0. Подготовка и архитектура
- [x] Изучить `WEB_API_ANALYSIS.md`, зафиксировать области ответственности и критичные сценарии.
- [x] Уточнить нефункциональные требования: базовые ожидания получены → Python backend, современный веб-дизайн фронтенда, контейнеризация через Docker.
- [x] Согласовать стек: FastAPI + httpx для BFF, React + Vite + TypeScript + Material UI для UI, доп. сервисы при необходимости (PostgreSQL/Redis), Docker + docker-compose для контейнеризации.

## Этап 1. Инфраструктура проекта
- [x] Создать структуру репозитория: `backend/`, `frontend/`, `infra/`, `docs/`, `tests/`.
- [x] Настроить общую `.env`-схему и примеры (`.env.example`, `frontend/.env.example`).
- [x] Подготовить Dockerfile для backend (Python 3.12, Uvicorn) и frontend (Node 18+, build → nginx/alpine).
- [x] Собрать `docker-compose.yml` с сетями, volumes и заглушечным проксированием запросов.
- [x] Описать инструкции запуска в `README.md`.

## Этап 2. Backend-for-Frontend (BFF)
- [x] Создать FastAPI-приложение с модульной структурой (`routers`, `services`, `schemas`, `auth`, `config`).
- [x] Реализовать клиент для исходного админского API (классы на httpx/async, ретраи, таймауты, метрики).
- [x] Встроить авторизацию админки (JWT/Session) + проверку доступа по ролям и привязка к API-токенам исходного сервиса.
- [x] Настроить базовые middleware (correlation id, CORS) и health-endpoint через исходный API.
- [x] Настроить проксирование/агрегацию эндпоинтов: нормализация данных, кеши для справочников, пост-обработка ошибок.
- [x] Добавить middleware для аудита (логирование действий, correlation id).

## Этап 3. Frontend-приложение
- [ ] Инициализировать Vite + React + TypeScript, настроить архитектуру (feature-sliced или аналог).
- [ ] Подключить Material UI (или Mantine/Chakra) + тему с поддержкой светлой/темной схем.
- [ ] Настроить маршрутизацию (React Router v6), охрану маршрутов (protected routes).
- [ ] Реализовать слой API-клиента (RTK Query/SWR) с типами, адаптерами ответов.
- [ ] Создать базовые UI-компоненты: таблицы, формы, модальные окна, уведомления, layout админки.

## Этап 4. Критический функционал (итерация 1)
- [ ] Health & Monitoring: `/health`, `/stats/*` – дашборды состояния, виджет фич-флагов.
- [ ] Пользователи: `/users/*`, `/user-groups/*`, `/user-notes/*` – список, карточка, CRUD, фильтры, баланс.
- [ ] Подписки: `/subscriptions/*`, `/subscription-plans/*`, `/devices/*` – управление планами, устройствами, продлением.
- [ ] Токены: `/tokens/*` – выпуск, отзыв, история использования, интеграция с аудитом.

## Этап 5. Расширенный функционал (итерация 2)
- [ ] Финансы и промо: `/transactions/*`, `/promo-codes/*`, `/promo-groups/*`, `/promo-offers/*`.
- [ ] Контент и коммуникации: `/pages/*`, `/broadcasts/*`, `/main-menu/*`, `/miniapp/*`.
- [ ] Поддержка и кампании: `/tickets/*`, `/campaigns/*`, `/notifications/*`.
- [ ] Бекапы и интеграции: `/backups/*`, `/remnawave/*`, `/remnawave-sync/*`.

## Этап 6. Поперечные задачи
- [ ] Унифицировать валидацию форм + сообщения об ошибках (i18n RU/EN).
- [ ] Добавить аудит действий (UI + backend), экспорт в CSV/JSON.
- [ ] Подключить метрики и алерты (Prometheus/Grafana или лог-сложение).
- [ ] Реализовать систему прав доступа по ролям/командам (RBAC).
- [ ] Автоматизировать smoke-тесты API (pytest, Playwright).

## Этап 7. Тестирование и документирование
- [ ] Покрыть backend unit/integration тестами, настроить GitHub Actions/CI.
- [ ] Написать E2E-сценарии для основных пользовательских потоков.
- [ ] Обновить документацию (`docs/`): схемы данных, диаграммы, инструкции обновления.
- [ ] Подготовить гид по деплою (docker-compose + инструкции переноса на сервер).
- [ ] Провести приемку, сформировать чек-лист регресса.

## Этап 8. Итоговая подготовка
- [ ] Провести performance review (профилирование тяжёлых запросов).
- [ ] Очистить/обновить примеры `.env`, скрипты `make`/`invoke`.
- [ ] Сформировать релизный пакет (образы, теги, changelog).
- [ ] Зафиксировать оставшиеся доработки и roadmap для следующих спринтов.
- [ ] Передать проект на сервер для финальных проверок заказчика.
